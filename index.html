<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOKYO TRIP 2025</title>
    
    <!-- iOS Icons & PWA -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3014/3014239.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Noto+Sans+TC:wght@300;400;700&family=Rubik:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel Standalone -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bp-black': '#121212',
                        'bp-dark': '#1e1e1e',
                        'bp-pink': '#FF69B4', // Hot Pink
                        'bp-soft-pink': '#F8C8DC',
                        'bp-coffee': '#6F4E37',
                        'bp-coffee-light': '#A67B5B',
                    },
                    fontFamily: {
                        'heading': ['"Fredoka One"', 'sans-serif'],
                        'body': ['"Rubik"', '"Noto Sans TC"', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 10px rgba(255, 105, 180, 0.5)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.5)',
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'fadeIn': 'fadeIn 0.3s ease-in-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeIn: {
                            'from': { opacity: '0', transform: 'translateY(10px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: 'Rubik', 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Prevent bounce effect on mobile */
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        ::-webkit-scrollbar-thumb {
            background: #6F4E37;
            border-radius: 3px;
        }

        /* Safe area padding for iPhones with notch */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Hide Scrollbar for tabs */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
        const { useState, useMemo, useEffect, useRef } = React;

        // --- TYPES ---
        interface TransportInfo {
            outbound: string;
            mrt?: string;
            title?: string;
        }

        interface FlightInfoDetails {
            date: string;
            airline: string;
            time: string;
        }

        interface FlightInfo {
            outbound: FlightInfoDetails;
            inbound: FlightInfoDetails;
        }

        interface HotelInfo {
            name: string;
            address: string;
            tel: string;
            note: string;
        }

        interface TransportData {
            hsr: TransportInfo;
            flight: FlightInfo;
            hotel: HotelInfo;
        }

        interface Event {
            time: string;
            title: string;
            note?: string;
            address?: string;
            type?: 'transport' | 'hotel' | 'highlight' | 'flight' | 'default';
        }

        interface ItineraryDay {
            day: string;
            date: string;
            title: string;
            events: Event[];
        }

        interface Item {
            id?: number;
            area: string;
            name: string;
            address: string;
            note?: string;
            tag?: string;
            description?: string;
        }

        interface PackingList {
            [category: string]: string[];
        }

        interface InitialData {
            transport: TransportData;
            itinerary: ItineraryDay[];
            foods: Item[];
            places: Item[];
            packingList: PackingList;
        }

        interface ShoppingItem {
            id: number;
            text: string;
            done: boolean;
        }

        // --- CONSTANTS ---
        const INITIAL_DATA: InitialData = {
            transport: {
                hsr: {
                    title: "高鐵 & 機捷",
                    outbound: "1/16 台中(22:24) -> 桃園(23:23) 車次862",
                    mrt: "A18高鐵桃園站(23:34) -> A12機場一航(23:55)"
                },
                flight: {
                    outbound: {
                        date: "1/16",
                        airline: "樂桃 MM620",
                        time: "02:25 起飛 (T1) -> 06:30 抵達 (成田T1)"
                    },
                    inbound: {
                        date: "1/19",
                        airline: "星宇 JX805",
                        time: "20:10 起飛 -> 23:20 抵達 (桃園)"
                    }
                },
                hotel: {
                    name: "三井花園飯店日本橋普米爾",
                    address: "東京都中央區日本橋室町3-4-4",
                    tel: "+81 3-3270-1131",
                    note: "1/16 - 1/19 (3晚)"
                }
            },
            itinerary: [
                {
                    day: "DAY 1",
                    date: "1/16 (四)",
                    title: "抵達 & BLACKPINK 演唱會",
                    events: [
                        { time: "06:30", title: "抵達成田機場 T1", type: "transport" },
                        { time: "07:37", title: "搭乘 NEX 前往東京車站", note: "備選: 08:12, 08:49 (需換票)", type: "transport" },
                        { time: "10:00", title: "飯店寄放行李", address: "東京都中央區日本橋室町3-4-4", type: "hotel" },
                        { time: "12:00", title: "午餐時間", note: "周邊探索" },
                        { time: "16:30", title: "BLACKPINK 演唱會", address: "Tokyo Dome", type: "highlight" },
                        { time: "20:00", title: "晚餐", note: "視演唱會結束時間而定" }
                    ]
                },
                {
                    day: "DAY 2",
                    date: "1/17 (五)",
                    title: "富士山網美一日遊",
                    events: [
                        { time: "08:00", title: "集合出發 (切勿遲到)", address: "JR東京站丸之內南口", type: "highlight", note: "一日遊巴士接送" },
                        { time: "10:30", title: "天梯小鎮 & 羅森便利店", note: "網紅打卡點" },
                        { time: "12:30", title: "忍野八海", note: "欣賞富士山泉水" },
                        { time: "14:30", title: "河口湖", note: "湖畔美景" },
                        { time: "18:00", title: "返回東京" }
                    ]
                },
                {
                    day: "DAY 3",
                    date: "1/18 (六)",
                    title: "輕井澤購物 & 美食",
                    events: [
                        { time: "07:26", title: "北陸新幹線 (上野出發)", note: "備選: 07:30, 07:58, 08:18, 08:26", type: "transport" },
                        { time: "09:00", title: "輕井澤王子購物廣場", note: "全日購物行" },
                        { time: "18:00", title: "返回東京", type: "transport" }
                    ]
                },
                {
                    day: "DAY 4",
                    date: "1/19 (日)",
                    title: "最後採買 & 回家",
                    events: [
                        { time: "10:00", title: "退房 & 寄放行李", type: "hotel" },
                        { time: "11:00", title: "隨興逛街", note: "補齊購物清單" },
                        { time: "16:00", title: "前往機場", type: "transport" },
                        { time: "20:10", title: "搭機回台 (JX805)", type: "flight" }
                    ]
                }
            ],
            foods: [
                { 
                    area: "池袋", 
                    name: "yellow池袋店", 
                    address: "Tokyo, Toshima City, Higashiikebukuro, 1 Chome−27−5 関口ビル Ｂ号室",
                    description: "以半熟滑嫩的歐姆蛋包飯聞名，切開的瞬間蛋液流出的畫面超療癒，醬汁濃郁，是池袋的人氣排隊名店。"
                },
                { 
                    area: "淺草", 
                    name: "Ginza Brazil", 
                    address: "Tokyo, Taito City, Asakusa, 1 Chome−28−2 シカゴビル", 
                    note: "老字號咖啡店",
                    description: "昭和風情的復古喫茶店，必點招牌「炸豬排三明治」，酥脆麵包夾著多汁豬排，配上一杯手沖咖啡，享受淺草的慢時光。"
                },
                { 
                    area: "淺草", 
                    name: "Pelican CAFÉ", 
                    address: "Tokyo, Taito City, Kotobuki, 3 Chome−9−11 1階",
                    description: "由東京麵包名店「Pelican」直營的咖啡廳，炭烤吐司香氣迷人，口感Q彈有嚼勁，是麵包控絕對不能錯過的早午餐。"
                },
                { 
                    area: "下北澤", 
                    name: "Kokochi", 
                    address: "5 Chome-29-8 Daizawa, Setagaya City, Tokyo",
                    description: "下北澤人氣湯咖哩與漢堡排專賣店，蔬菜份量十足，湯頭香料層次豐富，非常適合逛街後來補充體力。"
                },
                { 
                    area: "上野", 
                    name: "American Diner Andra", 
                    address: "5 Chome-13-7 Higashiueno, Taito City, Tokyo", 
                    note: "漢堡排",
                    description: "隱藏版美式餐館，多汁的手打漢堡排與起司醬是絕配，份量豪邁，店內充滿美式復古氛圍。"
                },
                { 
                    area: "白金", 
                    name: "A5 和牛焼肉 KIM", 
                    address: "2 Chome-2-2 Shirokane, Minato City, Tokyo",
                    description: "高級住宅區內的隱密燒肉店，提供高品質 A5 和牛，入口即化，建議提前預約，享受奢華的肉食饗宴。"
                },
                { 
                    area: "銀座", 
                    name: "銀座Sun-mi 香川壽喜燒", 
                    address: "Tokyo, Chuo City, Ginza, 6 Chome−3−9-4 階5階",
                    description: "銀座老字號本店，午餐時段CP值極高，可以平價享用到正宗的黑毛和牛壽喜燒，服務親切貼心。"
                },
                { 
                    area: "銀座", 
                    name: "Bills銀座", 
                    address: "東京都中央區銀座 2-6-12 Okura House 12F",
                    description: "被譽為「世界第一好吃的早餐」，招牌瑞可塔起司鬆餅口感如雲朵般鬆軟，銀座店環境高雅，適合貴婦下午茶。"
                },
                { 
                    area: "湯島", 
                    name: "蟹食放題 ごっつお", 
                    address: "東京都文京區湯島ライワビル 4F",
                    description: "螃蟹吃到飽名店！提供三大蟹（帝王蟹、松葉蟹、毛蟹）無限暢食，海鮮愛好者的天堂，記得準備好剝殼工具！"
                }
            ],
            places: [
                { 
                    area: "世田谷", 
                    name: "豪德寺", 
                    address: "東京都世田谷區豪德寺2-24-7", 
                    note: "招財貓發源地",
                    description: "傳說中招財貓的發源地，供奉著上千隻大小不一的白色招財貓，場面壯觀又可愛，是近期IG超火紅的打卡聖地。"
                },
                { 
                    area: "淺草", 
                    name: "今戶神社", 
                    address: "東京都台東區今戶1丁目5-22", 
                    note: "戀愛神社",
                    description: "以祈求良緣聞名的神社，也是另一種招財貓傳說的發源地。繪馬是圓形的，象徵「圓滿」，非常受女性歡迎。"
                },
                { 
                    area: "淺草", 
                    name: "淺草寺 雷門", 
                    address: "2 Chome-3-1 Asakusa, Taito City, Tokyo",
                    description: "東京最古老的寺廟，巨大的紅色雷門燈籠是東京的地標。仲見世通商店街有各種傳統小吃與紀念品，人潮總是絡繹不絕。"
                },
                { 
                    area: "原宿", 
                    name: "Onitsuka Tiger", 
                    address: "Tokyo, Shibuya, Jingumae, 4 Chome−24−14", 
                    tag: "SHOP",
                    description: "鬼塚虎全球旗艦店，款式最齊全，常有日本限定款。Nippon Made日本製系列質感極佳，是潮流人士必逛。"
                },
                { 
                    area: "新宿", 
                    name: "Birkenstock", 
                    address: "Tokyo, Shinjuku City, Shinjuku, 3 Chome−33−10 新宿モリエール ビル 1F", 
                    tag: "SHOP",
                    description: "德國勃肯鞋專賣店，款式比台灣多且常有日本限定配色。提供專業量腳服務，能找到最適合自己腳型的鞋款。"
                },
                { 
                    area: "新宿", 
                    name: "GINZA SIX", 
                    address: "Tokyo, Chuo City, Ginza, 6 Chome−10-1", 
                    tag: "SHOP",
                    description: "銀座最大的奢華購物中心，結合藝術與時尚。中庭常有草間彌生等大師的裝置藝術，頂樓花園可眺望銀座街景。"
                }, 
                { 
                    area: "銀座", 
                    name: "Uniqlo 旗艦店", 
                    address: "Tokyo, Chuo City, Ginza, 6 Chome−9−5", 
                    tag: "SHOP",
                    description: "全球最大UNIQLO旗艦店之一，整棟12層樓。有許多銀座限定的聯名T恤與客製化服務，花店區也非常好拍。"
                }
            ],
            packingList: {
                "必備證件": ["護照", "信用卡", "身分證", "現金 (日幣/台幣)", "身分證影本", "護照影本", "網卡/漫遊開通"],
                "電子產品": ["手機", "充電線", "行動電源", "萬國插座", "GoPro/相機", "相機電池/記憶卡"],
                "生活雜物": ["衣物", "帽子", "太陽眼鏡", "隱形眼鏡", "梳子", "保養品(乳液/護手霜)", "常備藥(感冒/腸胃/暈車)"]
            }
        };

        // --- COMPONENTS ---

        // Icon
        const Icon = ({ name, className = '' }) => {
            return <i className={`fa-solid fa-${name} ${className}`}></i>;
        };

        // MapButton
        const MapButton = ({ address, label = "Google Map" }) => {
            if (!address) return null;
            
            const openMap = (e) => {
                e.stopPropagation();
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank');
            };

            return (
                <button 
                    onClick={openMap} 
                    className="mt-2 text-xs bg-bp-coffee text-white px-3 py-1.5 rounded-full flex items-center gap-1 active:scale-95 transition-transform"
                >
                    <Icon name="location-dot" /> {label}
                </button>
            );
        };

        // PlanView
        const PlanView = ({ data }) => {
            const [activeDayIdx, setActiveDayIdx] = useState(0);
            const activeDay = data.itinerary[activeDayIdx];

            // BLACKPINK Default Cover
            const DEFAULT_COVER = "data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23121212'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial, sans-serif' font-weight='900' font-size='120' fill='%23FF69B4' letter-spacing='8'%3EBLACKPINK%3C/text%3E%3C/svg%3E";
            
            const [coverImage, setCoverImage] = useState(DEFAULT_COVER);
            const fileInputRef = useRef(null);

            const updateAppIcons = (imageUrl) => {
                const appleIcon = document.querySelector('link[rel="apple-touch-icon"]');
                if (appleIcon) appleIcon.href = imageUrl;

                let favicon = document.querySelector('link[rel="icon"]') || document.querySelector('link[rel="shortcut icon"]');
                if (!favicon) {
                    favicon = document.createElement('link');
                    favicon.setAttribute('rel', 'icon');
                    document.head.appendChild(favicon);
                }
                favicon.href = imageUrl;
            };

            useEffect(() => {
                const savedCover = localStorage.getItem('trip_cover_image');
                if (savedCover) {
                    setCoverImage(savedCover);
                    updateAppIcons(savedCover);
                } else {
                    updateAppIcons(DEFAULT_COVER);
                }
            }, []);

            const handleImageUpload = (e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const base64String = reader.result;
                        try {
                            localStorage.setItem('trip_cover_image', base64String);
                            setCoverImage(base64String);
                            updateAppIcons(base64String);
                        } catch (error) {
                            alert("圖片太大了，無法儲存！");
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            const triggerUpload = () => {
                fileInputRef.current?.click();
            };

            const resetCover = (e) => {
                e.stopPropagation();
                if(window.confirm('確定要還原成預設封面嗎？')) {
                    localStorage.removeItem('trip_cover_image');
                    setCoverImage(DEFAULT_COVER);
                    updateAppIcons(DEFAULT_COVER);
                }
            };

            return (
                <div className="space-y-6 pb-6">
                    {/* Header Image Area */}
                    <div className="relative h-80 bg-bp-dark rounded-b-[2.5rem] overflow-hidden border-b-4 border-bp-pink shadow-2xl group">
                        <img 
                            src={coverImage} 
                            alt="Tokyo Trip Cover" 
                            className="w-full h-full object-cover opacity-90 transition-transform duration-700 group-hover:scale-105"
                        />
                        
                        {/* Image Edit Controls */}
                        <div className="absolute top-4 right-4 flex flex-col items-end gap-2 z-30">
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                onChange={handleImageUpload} 
                                accept="image/*" 
                                className="hidden" 
                            />
                            
                            <button 
                                onClick={triggerUpload}
                                className="bg-black/60 hover:bg-bp-pink hover:text-black text-white px-4 py-2 rounded-full backdrop-blur-md border border-white/30 flex items-center gap-2 transition-all duration-300 shadow-lg active:scale-95 group"
                            >
                                <Icon name="camera" />
                                <span className="font-bold text-sm tracking-wide">更換封面</span>
                            </button>

                            {coverImage !== DEFAULT_COVER && (
                                <button 
                                    onClick={resetCover}
                                    className="bg-red-600/80 hover:bg-red-500 text-white px-3 py-1.5 rounded-full backdrop-blur-md border border-white/20 flex items-center gap-1 transition-all text-xs shadow-md active:scale-95"
                                >
                                    <Icon name="rotate-left" />
                                    <span>還原</span>
                                </button>
                            )}
                        </div>

                        {/* Gradient Overlay for Text Readability */}
                        <div className="absolute inset-0 bg-gradient-to-t from-bp-black/90 via-bp-black/20 to-transparent flex flex-col items-center justify-end pb-12 pointer-events-none">
                            <h1 className="text-5xl font-heading text-bp-pink drop-shadow-[0_2px_10px_rgba(255,105,180,0.6)] tracking-widest transform -rotate-2">TOKYO</h1>
                            <div className="flex items-center gap-3 mt-2">
                                <span className="h-px w-8 bg-white/50"></span>
                                <p className="text-white text-sm font-bold tracking-[0.4em] drop-shadow-md">TRIP 2025</p>
                                <span className="h-px w-8 bg-white/50"></span>
                            </div>
                        </div>
                    </div>

                    {/* Flight & Transport */}
                    <div className="px-4 -mt-8 relative z-10">
                        <div className="bg-bp-dark/95 backdrop-blur-md border border-gray-700 p-4 rounded-2xl shadow-xl mb-6">
                             <h2 className="text-lg font-heading text-white mb-3 flex items-center gap-2 border-b border-gray-700 pb-2">
                                <Icon name="plane" className="text-bp-pink" /> 
                                <span>FLIGHT INFO</span>
                            </h2>
                             <div className="grid grid-cols-1 gap-3">
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-gray-400">去程</span>
                                    <span className="font-bold text-white text-right">{data.transport.flight.outbound.airline} <br/> <span className="text-xs font-normal text-bp-pink">{data.transport.flight.outbound.time}</span></span>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-gray-400">回程</span>
                                    <span className="font-bold text-white text-right">{data.transport.flight.inbound.airline} <br/> <span className="text-xs font-normal text-bp-pink">{data.transport.flight.inbound.time}</span></span>
                                </div>
                            </div>
                        </div>

                        <h2 className="text-xl font-heading text-white mb-3 flex items-center gap-2">
                            <span className="w-2 h-8 bg-bp-pink rounded-full block"></span> TRANSPORT & HOTEL
                        </h2>
                        <div className="grid gap-3">
                            <div className="bp-card p-4">
                                <div className="flex justify-between items-center mb-2">
                                    <span className="text-bp-pink font-bold"><Icon name="train" /> 高鐵去程</span>
                                    <span className="text-xs text-gray-400">1/16</span>
                                </div>
                                <p className="text-sm">{data.transport.hsr.outbound}</p>
                                <p className="text-xs text-gray-400 mt-1">{data.transport.hsr.mrt}</p>
                            </div>
                            
                            <div className="bp-card p-4 border-bp-coffee">
                                <h3 className="text-bp-coffee-light font-bold mb-1"><Icon name="hotel" /> {data.transport.hotel.name}</h3>
                                <p className="text-xs text-gray-400 mb-2">{data.transport.hotel.note}</p>
                                <MapButton address={data.transport.hotel.address} label="導航至飯店" />
                            </div>
                        </div>
                    </div>

                    {/* Itinerary Schedule Tabs */}
                    <div className="px-4 mt-8">
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-xl font-heading text-white flex items-center gap-2">
                                <span className="w-2 h-8 bg-bp-pink rounded-full block"></span> SCHEDULE
                            </h2>
                        </div>

                        {/* Day Tabs */}
                        <div className="flex space-x-2 mb-4 overflow-x-auto pb-2 custom-scrollbar no-scrollbar">
                            {data.itinerary.map((day, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => setActiveDayIdx(idx)}
                                    className={`flex-1 min-w-[4.5rem] py-2 px-1 rounded-lg transition-all duration-300 flex flex-col items-center justify-center border ${
                                        activeDayIdx === idx 
                                            ? 'bg-bp-pink border-bp-pink text-bp-black shadow-glow transform -translate-y-1' 
                                            : 'bg-gray-800 border-gray-700 text-gray-400 hover:bg-gray-700'
                                    }`}
                                >
                                    <span className="font-heading text-lg leading-none">{day.day.replace('DAY ', 'D')}</span>
                                    <span className="text-[10px] opacity-80 mt-1 font-bold">{day.date.split(' ')[0]}</span>
                                </button>
                            ))}
                        </div>

                        {/* Selected Day Content */}
                        <div key={activeDayIdx} className="animate-fadeIn">
                            <div className="bg-bp-dark rounded-xl p-5 shadow-lg border border-gray-800 relative overflow-hidden min-h-[300px]">
                                {/* Header */}
                                <div className="flex justify-between items-start border-b border-gray-700 pb-3 mb-5">
                                    <div>
                                        <h3 className="text-3xl font-heading text-bp-pink">{activeDay.day}</h3>
                                        <div className="text-gray-400 text-sm mt-1 flex items-center gap-2">
                                            <Icon name="calendar" className="text-xs" />
                                            {activeDay.date}
                                        </div>
                                    </div>
                                    <div className="text-right max-w-[50%]">
                                        <h4 className="text-lg font-bold text-white leading-tight">{activeDay.title}</h4>
                                    </div>
                                </div>
                                
                                {/* Events Timeline */}
                                <div className="relative pl-4 border-l-2 border-gray-700 space-y-8 pb-2">
                                    {activeDay.events.map((evt, eIdx) => (
                                        <div key={eIdx} className="relative group">
                                            {/* Timeline Dot */}
                                            <div className={`absolute -left-[23px] top-1.5 w-3.5 h-3.5 rounded-full border-2 border-bp-dark transition-all duration-300 ${
                                                evt.type === 'highlight' 
                                                    ? 'bg-bp-pink shadow-[0_0_10px_rgba(255,105,180,0.8)] scale-110' 
                                                    : 'bg-gray-600 group-hover:bg-bp-coffee-light'
                                            }`}></div>
                                            
                                            <div className="flex flex-col">
                                                <div className="flex items-baseline gap-3 mb-1">
                                                    <span className={`text-lg font-bold font-mono tracking-wide ${
                                                        evt.type === 'highlight' ? 'text-bp-pink' : 'text-bp-coffee-light'
                                                    }`}>
                                                        {evt.time}
                                                    </span>
                                                </div>
                                                
                                                <div className={`p-3 rounded-lg border ${
                                                    evt.type === 'highlight' 
                                                        ? 'bg-gray-800/80 border-bp-pink/30' 
                                                        : 'bg-transparent border-transparent pl-0 pt-0'
                                                }`}>
                                                    <span className="text-base text-gray-100 font-medium block mb-1">{evt.title}</span>
                                                    
                                                    {evt.note && (
                                                        <span className="text-xs text-gray-500 block flex items-center gap-1">
                                                            <Icon name="circle-info" className="text-[10px]" /> {evt.note}
                                                        </span>
                                                    )}
                                                    
                                                    {evt.address && (
                                                        <div className="mt-2">
                                                            <MapButton address={evt.address} />
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // CardList
        const CardList = ({ items, type, onAdd }) => {
            const [newItem, setNewItem] = useState({ name: '', address: '', note: '' });
            const [isAdding, setIsAdding] = useState(false);

            const handleAdd = () => {
                if(!newItem.name) return;
                onAdd({ ...newItem, area: 'New', id: Date.now() });
                setNewItem({ name: '', address: '', note: '' });
                setIsAdding(false);
            };

            return (
                <div className="px-4 pb-6 pt-4">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-2xl font-heading text-white tracking-widest">{type} GUIDE</h2>
                        <button 
                            onClick={() => setIsAdding(!isAdding)} 
                            className="bg-bp-pink text-bp-black w-8 h-8 rounded-full flex items-center justify-center font-bold text-xl shadow-glow active:scale-90 transition-transform"
                        >
                            {isAdding ? '-' : '+'}
                        </button>
                    </div>

                    {isAdding && (
                        <div className="bg-gray-800 p-4 rounded-lg mb-4 animate-fadeIn border border-bp-pink">
                            <input placeholder="名稱" className="w-full bg-gray-900 p-2 rounded mb-2 text-white border border-gray-700 outline-none focus:border-bp-pink" value={newItem.name} onChange={e=>setNewItem({...newItem, name: e.target.value})} />
                            <input placeholder="地址" className="w-full bg-gray-900 p-2 rounded mb-2 text-white border border-gray-700 outline-none focus:border-bp-pink" value={newItem.address} onChange={e=>setNewItem({...newItem, address: e.target.value})} />
                            <input placeholder="備註 (如: 必吃)" className="w-full bg-gray-900 p-2 rounded mb-2 text-white border border-gray-700 outline-none focus:border-bp-pink" value={newItem.note} onChange={e=>setNewItem({...newItem, note: e.target.value})} />
                            <button onClick={handleAdd} className="w-full bg-bp-coffee text-white py-2 rounded font-bold hover:bg-bp-coffee-light transition-colors">新增至清單</button>
                        </div>
                    )}

                    <div className="grid grid-cols-1 gap-4">
                        {items.map((item, idx) => (
                            <div key={idx} className="bg-bp-dark rounded-lg overflow-hidden border border-gray-800 shadow-card flex flex-col hover:border-gray-600 transition-colors">
                                <div className="p-4 flex-1">
                                    <div className="flex justify-between items-start mb-2">
                                        <span className="text-xs bg-gray-800 text-bp-pink px-2 py-0.5 rounded uppercase tracking-wide border border-gray-700">{item.area}</span>
                                        {item.tag && <span className="text-xs bg-bp-coffee text-white px-2 py-0.5 rounded">{item.tag}</span>}
                                    </div>
                                    
                                    <h3 className="text-lg font-bold text-white leading-tight mb-1">{item.name}</h3>
                                    
                                    {/* Description Section */}
                                    {item.description && (
                                        <p className="text-sm text-gray-300 leading-relaxed mb-2 border-l-2 border-gray-600 pl-2 mt-2">
                                            {item.description}
                                        </p>
                                    )}

                                    {/* Note Section */}
                                    {item.note && (
                                        <div className="flex items-start gap-1 text-xs text-bp-pink/80 mt-1">
                                            <Icon name="pen-to-square" className="mt-0.5" />
                                            <span className="italic">{item.note}</span>
                                        </div>
                                    )}
                                </div>
                                <div className="px-4 pb-4">
                                    <button 
                                        onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.address)}`, '_blank')}
                                        className="w-full bg-gray-800 hover:bg-gray-700 text-gray-300 text-sm py-2 rounded flex items-center justify-center gap-2 border border-gray-700 transition-colors active:scale-[0.98]"
                                    >
                                        <Icon name="location-arrow" /> GOOGLE MAP
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ListsView
        const ListsView = ({ initialPacking }) => {
            const [activeSubTab, setActiveSubTab] = useState('PACK');
            
            // CheckList State
            const [checks, setChecks] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('trip_checks') || '{}');
                } catch { return {}; }
            });

            const toggleCheck = (key) => {
                const newChecks = { ...checks, [key]: !checks[key] };
                setChecks(newChecks);
                localStorage.setItem('trip_checks', JSON.stringify(newChecks));
            };

            // Memo State
            const [memo, setMemo] = useState(() => localStorage.getItem('trip_memo') || '');
            
            useEffect(() => {
                localStorage.setItem('trip_memo', memo);
            }, [memo]);

            // Shopping List State
            const [shopList, setShopList] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('trip_shoplist') || '[]');
                } catch { return []; }
            });
            
            const [newShopItem, setNewShopItem] = useState('');

            const addShopItem = () => {
                if(!newShopItem.trim()) return;
                const newList = [...shopList, { id: Date.now(), text: newShopItem, done: false }];
                setShopList(newList);
                localStorage.setItem('trip_shoplist', JSON.stringify(newList));
                setNewShopItem('');
            };

            const toggleShopItem = (id) => {
                const newList = shopList.map(i => i.id === id ? { ...i, done: !i.done } : i);
                setShopList(newList);
                localStorage.setItem('trip_shoplist', JSON.stringify(newList));
            };

            const deleteShopItem = (id) => {
                const newList = shopList.filter(i => i.id !== id);
                setShopList(newList);
                localStorage.setItem('trip_shoplist', JSON.stringify(newList));
            };

            // Helper to render text with links
            const renderTextWithLinks = (text) => {
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                const parts = text.split(urlRegex);
                return parts.map((part, i) => 
                    urlRegex.test(part) ? <a key={i} href={part} target="_blank" rel="noopener noreferrer" className="text-bp-pink underline break-all">{part}</a> : part
                );
            };

            return (
                <div className="pb-6 pt-4 h-full flex flex-col">
                    <div className="px-4 mb-4">
                        <div className="flex bg-gray-800 rounded-lg p-1">
                            {['PACK', 'SHOP', 'MEMO'].map(tab => (
                                <button 
                                    key={tab}
                                    onClick={() => setActiveSubTab(tab)}
                                    className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${activeSubTab === tab ? 'bg-bp-pink text-black shadow-md' : 'text-gray-400'}`}
                                >
                                    {tab === 'PACK' && '必備'}
                                    {tab === 'SHOP' && '購物'}
                                    {tab === 'MEMO' && '備忘'}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto px-4 tab-content custom-scrollbar">
                        {activeSubTab === 'PACK' && (
                            <div className="space-y-6">
                                {Object.entries(initialPacking).map(([category, items]) => (
                                    <div key={category}>
                                        <h3 className="text-bp-coffee-light font-bold mb-2 border-b border-gray-800 pb-1">{category}</h3>
                                        <div className="space-y-2">
                                            {items.map(item => (
                                                <div 
                                                    key={item} 
                                                    onClick={() => toggleCheck(item)} 
                                                    className="flex items-center gap-3 p-3 bg-bp-dark rounded-lg active:scale-[0.98] transition-transform cursor-pointer border border-transparent hover:border-gray-700"
                                                >
                                                    <div className={`w-5 h-5 rounded border flex items-center justify-center transition-colors ${checks[item] ? 'bg-bp-pink border-bp-pink' : 'border-gray-500'}`}>
                                                        {checks[item] && <Icon name="check" className="text-black text-xs" />}
                                                    </div>
                                                    <span className={checks[item] ? 'text-gray-500 line-through' : 'text-white'}>{item}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeSubTab === 'SHOP' && (
                            <div>
                                <div className="flex gap-2 mb-4">
                                    <input 
                                        type="text" 
                                        className="flex-1 bg-gray-800 text-white px-4 py-2 rounded-lg outline-none border border-transparent focus:border-bp-pink transition-colors"
                                        placeholder="輸入想買的東西..."
                                        value={newShopItem}
                                        onChange={(e) => setNewShopItem(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addShopItem()}
                                    />
                                    <button onClick={addShopItem} className="bg-bp-coffee text-white px-4 rounded-lg active:scale-95 transition-transform"><Icon name="plus" /></button>
                                </div>
                                <div className="space-y-2">
                                    {shopList.map(item => (
                                        <div key={item.id} className="flex items-center justify-between p-3 bg-bp-dark rounded-lg group">
                                            <div className="flex items-center gap-3 flex-1 overflow-hidden cursor-pointer" onClick={() => toggleShopItem(item.id)}>
                                                <div className={`w-5 h-5 min-w-[1.25rem] rounded border flex items-center justify-center transition-colors ${item.done ? 'bg-gray-600 border-gray-600' : 'border-bp-pink'}`}>
                                                    {item.done && <Icon name="check" className="text-white text-xs" />}
                                                </div>
                                                <span className={`truncate ${item.done ? 'text-gray-600 line-through' : 'text-white'}`}>
                                                    {renderTextWithLinks(item.text)}
                                                </span>
                                            </div>
                                            <button onClick={() => deleteShopItem(item.id)} className="text-gray-600 hover:text-red-500 px-2 transition-colors">
                                                <Icon name="trash" />
                                            </button>
                                        </div>
                                    ))}
                                    {shopList.length === 0 && <div className="text-center text-gray-500 mt-10">尚無購物清單，快去買爆！</div>}
                                </div>
                            </div>
                        )}

                        {activeSubTab === 'MEMO' && (
                            <div className="h-full flex flex-col">
                                <textarea 
                                    className="w-full h-96 bg-bp-dark text-white p-4 rounded-lg border border-gray-700 focus:border-bp-pink outline-none leading-relaxed resize-none"
                                    placeholder="在此輸入筆記，網址會自動變成連結..."
                                    value={memo}
                                    onChange={(e) => setMemo(e.target.value)}
                                ></textarea>
                                <div className="mt-4 p-4 bg-gray-900 rounded-lg text-sm text-gray-400 break-words border border-gray-800">
                                    <p className="mb-2 font-bold text-gray-500">預覽 (可點擊連結):</p>
                                    <div className="whitespace-pre-wrap">{renderTextWithLinks(memo)}</div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // InfoView
        const InfoView = () => {
            const [qrCode, setQrCode] = useState(null);
            const fileInputRef = useRef(null);

            // Load QR Code from localStorage on mount
            useEffect(() => {
                const savedQr = localStorage.getItem('trip_entry_qrcode');
                if (savedQr) {
                    setQrCode(savedQr);
                }
            }, []);

            const handleFileChange = (e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const base64String = reader.result;
                        // Basic quota check (localStorage usually 5MB). 
                        try {
                            localStorage.setItem('trip_entry_qrcode', base64String);
                            setQrCode(base64String);
                        } catch (error) {
                            alert("圖片太大了，無法儲存！請嘗試截圖小一點的範圍。");
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleDeleteQr = (e) => {
                e.stopPropagation();
                if(window.confirm('確定要刪除入境 QR Code 嗎？')) {
                    localStorage.removeItem('trip_entry_qrcode');
                    setQrCode(null);
                    if(fileInputRef.current) fileInputRef.current.value = '';
                }
            };

            const triggerUpload = () => {
                fileInputRef.current?.click();
            };

            return (
                <div className="px-6 py-8 space-y-6 pb-6">
                    <h2 className="text-3xl font-heading text-center text-white mb-8">INFO</h2>
                    
                    {/* Japan Entry QR Code Section */}
                    <div className="mb-6">
                        <div 
                            onClick={qrCode ? undefined : triggerUpload}
                            className={`relative w-full rounded-2xl border-2 transition-all overflow-hidden group ${qrCode ? 'border-bp-pink bg-black h-auto' : 'border-dashed border-gray-600 bg-gray-900 h-48 hover:border-bp-pink cursor-pointer active:scale-95'}`}
                        >
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                onChange={handleFileChange} 
                                accept="image/*" 
                                className="hidden" 
                            />

                            {qrCode ? (
                                <div className="relative">
                                    <img src={qrCode} alt="Entry QR Code" className="w-full h-auto block" />
                                    <div className="absolute top-2 right-2 flex gap-2">
                                        <button 
                                            onClick={triggerUpload} 
                                            className="bg-black/50 text-white p-2 rounded-full hover:bg-black/80 backdrop-blur-sm"
                                        >
                                            <Icon name="pen" />
                                        </button>
                                        <button 
                                            onClick={handleDeleteQr} 
                                            className="bg-red-600/80 text-white p-2 rounded-full hover:bg-red-700 backdrop-blur-sm"
                                        >
                                            <Icon name="trash" />
                                        </button>
                                    </div>
                                    <div className="bg-bp-pink text-bp-black text-center font-bold py-1 text-sm">
                                        Visit Japan Web 入境碼
                                    </div>
                                </div>
                            ) : (
                                <div className="absolute inset-0 flex flex-col items-center justify-center text-gray-400 gap-3">
                                    <Icon name="qrcode" className="text-4xl group-hover:text-bp-pink transition-colors" />
                                    <div className="text-center">
                                        <p className="font-bold text-white">上傳入境 QR Code</p>
                                        <p className="text-xs mt-1">Visit Japan Web 截圖</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4">
                            <a href="https://www.jma.go.jp/en/jma/index.html" target="_blank" rel="noopener noreferrer" className="bg-blue-900/50 p-6 rounded-xl flex flex-col items-center justify-center gap-2 border border-blue-800 active:scale-95 transition-transform hover:bg-blue-900/70">
                            <Icon name="cloud-sun" className="text-4xl text-blue-400" />
                            <span className="font-bold">天氣預報</span>
                        </a>
                            <a href="tel:110" className="bg-red-900/50 p-6 rounded-xl flex flex-col items-center justify-center gap-2 border border-red-800 active:scale-95 transition-transform hover:bg-red-900/70">
                            <Icon name="phone" className="text-4xl text-red-400" />
                            <span className="font-bold">警察 110</span>
                        </a>
                        <a href="tel:119" className="bg-red-900/50 p-6 rounded-xl flex flex-col items-center justify-center gap-2 border border-red-800 active:scale-95 transition-transform hover:bg-red-900/70">
                            <Icon name="ambulance" className="text-4xl text-red-400" />
                            <span className="font-bold">救護 119</span>
                        </a>
                        {/* 護照提醒保留一個小的 */}
                        <div className="bg-gray-800 p-6 rounded-xl flex flex-col items-center justify-center gap-2 border border-gray-700">
                            <Icon name="passport" className="text-4xl text-gray-400" />
                            <span className="font-bold text-center text-sm">護照隨身帶</span>
                        </div>
                    </div>

                    <div className="bp-card p-6 rounded-xl mt-6">
                        <h3 className="text-bp-pink font-bold mb-4 text-lg border-b border-gray-700 pb-2">注意事項</h3>
                        <ul className="list-disc pl-5 space-y-2 text-sm text-gray-300">
                            <li>日本電壓 100V (台灣插頭可用)。</li>
                            <li>走路不抽菸，請至指定吸菸區。</li>
                            <li>搭乘電車請將手機設為靜音。</li>
                            <li>入境禁止攜帶肉類製品、新鮮蔬果。</li>
                            <li>購物滿 5000 日圓(未稅)可退稅，需出示護照。</li>
                        </ul>
                    </div>
                    
                    <div className="text-center mt-10 opacity-50 pb-10">
                        <Icon name="heart" className="text-bp-pink animate-pulse" />
                        <p className="text-xs mt-2">Have a Safe Trip!</p>
                    </div>
                </div>
            );
        };

        // App
        const App = () => {
            const [activeTab, setActiveTab] = useState('PLAN');
            
            const [myFoods, setMyFoods] = useState(() => {
                try {
                    const saved = localStorage.getItem('trip_foods');
                    return saved ? JSON.parse(saved) : [];
                } catch {
                    return [];
                }
            });

            const [myPlaces, setMyPlaces] = useState(() => {
                try {
                    const saved = localStorage.getItem('trip_places');
                    return saved ? JSON.parse(saved) : [];
                } catch {
                    return [];
                }
            });

            const handleAddFood = (item) => {
                const newList = [...myFoods, item];
                setMyFoods(newList);
                localStorage.setItem('trip_foods', JSON.stringify(newList));
            };

            const handleAddPlace = (item) => {
                const newList = [...myPlaces, item];
                setMyPlaces(newList);
                localStorage.setItem('trip_places', JSON.stringify(newList));
            };

            const foods = useMemo(() => [...INITIAL_DATA.foods, ...myFoods], [myFoods]);
            const places = useMemo(() => [...INITIAL_DATA.places, ...myPlaces], [myPlaces]);

            const renderContent = () => {
                switch(activeTab) {
                    case 'PLAN': return <PlanView data={INITIAL_DATA} />;
                    case 'FOOD': return <CardList items={foods} type="FOOD" onAdd={handleAddFood} />;
                    case 'PLAY': return <CardList items={places} type="PLAY" onAdd={handleAddPlace} />;
                    case 'LISTS': return <ListsView initialPacking={INITIAL_DATA.packingList} />;
                    case 'INFO': return <InfoView />;
                    default: return <PlanView data={INITIAL_DATA} />;
                }
            };

            const tabs = [
                { id: 'PLAN', icon: 'calendar-days', label: '行程' },
                { id: 'FOOD', icon: 'utensils', label: '美食' },
                { id: 'PLAY', icon: 'camera-retro', label: '景點' },
                { id: 'LISTS', icon: 'list-check', label: '清單' },
                { id: 'INFO', icon: 'circle-info', label: '資訊' }
            ];

            return (
                <div className="min-h-screen bg-bp-black text-white relative max-w-md mx-auto shadow-2xl overflow-hidden flex flex-col">
                    {/* Content Area */}
                    <div className="flex-1 overflow-y-auto custom-scrollbar bg-bp-black">
                        {renderContent()}
                    </div>

                    {/* Bottom Navigation */}
                    <div className="bg-bp-black/95 backdrop-blur-md border-t border-gray-800 pb-safe pt-2 px-2 z-50 w-full shrink-0">
                        <div className="flex justify-around items-center h-16">
                            {tabs.map(tab => (
                                <button 
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex flex-col items-center justify-center w-14 transition-all duration-300 ${activeTab === tab.id ? 'text-bp-pink -translate-y-2' : 'text-gray-500'}`}
                                >
                                    <div className={`text-xl mb-1 ${activeTab === tab.id ? 'drop-shadow-[0_0_5px_rgba(255,105,180,0.8)]' : ''}`}>
                                        <Icon name={tab.icon} />
                                    </div>
                                    <span className="text-[10px] font-bold">{tab.label}</span>
                                    {activeTab === tab.id && <div className="w-1 h-1 bg-bp-pink rounded-full mt-1"></div>}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
